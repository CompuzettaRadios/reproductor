<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸŽµ Administrador de MÃºsica</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: system-ui; padding: 20px; background: #f5f5f5; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        h1 { margin-bottom: 20px; color: #333; }
        .section { margin-bottom: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        button { padding: 8px 16px; margin: 5px; border: none; border-radius: 4px; cursor: pointer; }
        .btn-primary { background: #007bff; color: white; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-success { background: #28a745; color: white; }
        input, select { padding: 6px; border: 1px solid #ddd; border-radius: 4px; margin: 2px; }
        .file-item { padding: 8px; border-bottom: 1px solid #eee; display: flex; align-items: center; gap: 10px; }
        .genre-form { display: flex; gap: 10px; align-items: center; margin-bottom: 10px; }
        .artist-form { display: flex; gap: 10px; align-items: center; margin-bottom: 10px; }
        .stats { display: flex; gap: 20px; margin: 10px 0; }
        .stat { padding: 10px; background: #e9ecef; border-radius: 4px; }
        .code-output { background: #f8f9fa; padding: 15px; border-radius: 4px; margin-top: 20px; font-family: monospace; white-space: pre-wrap; max-height: 400px; overflow-y: auto; }
        .hidden { display: none; }
        .message { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .message.success { background: #d4edda; color: #155724; }
        .message.error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸŽµ Administrador de MÃºsica</h1>
        
        <div class="section">
            <h3>Archivos MP3</h3>
            <input type="file" id="fileInput" multiple accept=".mp3" style="margin-bottom: 10px;">
            <button onclick="clearAll()" class="btn-danger">Limpiar Todo</button>
            <div id="messageArea"></div>
            <div class="stats" id="stats"></div>
        </div>

        <div class="section">
            <h3>Gestionar GÃ©neros</h3>
            <div class="genre-form">
                <input type="text" id="newGenre" placeholder="Nombre del gÃ©nero">
                <button onclick="addGenre()" class="btn-primary">Agregar</button>
            </div>
            <div id="genreList"></div>
        </div>

        <div class="section">
            <h3>Gestionar Artistas</h3>
            <div class="artist-form">
                <input type="text" id="newArtist" placeholder="Nombre del artista">
                <select id="artistGenre">
                    <option value="">Seleccionar gÃ©nero</option>
                </select>
                <button onclick="addArtist()" class="btn-primary">Agregar</button>
            </div>
            <div id="artistList"></div>
        </div>

        <div class="section" id="filesSection" class="hidden">
            <h3>Archivos Cargados</h3>
            <div id="fileList"></div>
        </div>

        <div class="section">
            <button onclick="generateCode()" class="btn-success">ðŸ“„ Generar CÃ³digo</button>
            <div id="codeOutput" class="code-output hidden"></div>
        </div>
    </div>

    <script>
        let files = [];
        let genres = [];
        let artists = {};

        document.getElementById('fileInput').addEventListener('change', handleFiles);

        function handleFiles(e) {
            const fileList = Array.from(e.target.files).filter(f => f.name.toLowerCase().endsWith('.mp3'));
            
            fileList.forEach(file => {
                if (!files.some(f => f.name === file.name)) {
                    files.push({
                        file: file,
                        name: file.name,
                        title: formatTitle(file.name),
                        genre: '',
                        artist: '',
                        id: Date.now() + Math.random()
                    });
                }
            });
            
            showMessage(`${fileList.length} archivos MP3 agregados`, 'success');
            updateDisplay();
        }

        function formatTitle(filename) {
            return filename.replace(/\.(mp3|MP3)$/, '').replace(/[-_]/g, ' ');
        }

        function addGenre() {
            const input = document.getElementById('newGenre');
            const genre = input.value.trim().toLowerCase();
            
            if (genre && !genres.includes(genre)) {
                genres.push(genre);
                artists[genre] = [];
                input.value = '';
                updateGenreDisplay();
                updateArtistGenreSelect();
                showMessage(`GÃ©nero "${genre}" agregado`, 'success');
            }
        }

        function removeGenre(genre) {
            genres = genres.filter(g => g !== genre);
            delete artists[genre];
            files.forEach(f => {
                if (f.genre === genre) {
                    f.genre = '';
                    f.artist = '';
                }
            });
            updateGenreDisplay();
            updateArtistGenreSelect();
            updateFileDisplay();
            showMessage(`GÃ©nero "${genre}" eliminado`, 'success');
        }

        function addArtist() {
            const nameInput = document.getElementById('newArtist');
            const genreSelect = document.getElementById('artistGenre');
            const artist = nameInput.value.trim();
            const genre = genreSelect.value;
            
            if (artist && genre && !artists[genre].includes(artist)) {
                artists[genre].push(artist);
                nameInput.value = '';
                updateArtistDisplay();
                showMessage(`Artista "${artist}" agregado al gÃ©nero "${genre}"`, 'success');
            }
        }

        function removeArtist(genre, artist) {
            artists[genre] = artists[genre].filter(a => a !== artist);
            files.forEach(f => {
                if (f.genre === genre && f.artist === artist) {
                    f.artist = '';
                }
            });
            updateArtistDisplay();
            updateFileDisplay();
            showMessage(`Artista "${artist}" eliminado`, 'success');
        }

        function updateGenreDisplay() {
            const list = document.getElementById('genreList');
            list.innerHTML = genres.map(genre => 
                `<div class="file-item">
                    <span>${genre}</span>
                    <button onclick="removeGenre('${genre}')" class="btn-danger">Eliminar</button>
                </div>`
            ).join('');
        }

        function updateArtistGenreSelect() {
            const select = document.getElementById('artistGenre');
            select.innerHTML = '<option value="">Seleccionar gÃ©nero</option>' +
                genres.map(genre => `<option value="${genre}">${genre}</option>`).join('');
        }

        function updateArtistDisplay() {
            const list = document.getElementById('artistList');
            list.innerHTML = '';
            
            genres.forEach(genre => {
                if (artists[genre] && artists[genre].length > 0) {
                    list.innerHTML += `<div><strong>${genre}:</strong></div>`;
                    artists[genre].forEach(artist => {
                        list.innerHTML += `<div class="file-item" style="margin-left: 20px;">
                            <span>${artist}</span>
                            <button onclick="removeArtist('${genre}', '${artist}')" class="btn-danger">Eliminar</button>
                        </div>`;
                    });
                }
            });
        }

        function updateFileDisplay() {
            const section = document.getElementById('filesSection');
            const list = document.getElementById('fileList');
            
            if (files.length === 0) {
                section.classList.add('hidden');
                return;
            }
            
            section.classList.remove('hidden');
            list.innerHTML = files.map(file => `
                <div class="file-item">
                    <input type="text" value="${file.title}" onchange="updateFileTitle('${file.id}', this.value)" style="flex: 1;">
                    <select onchange="updateFileGenre('${file.id}', this.value)">
                        <option value="">Seleccionar gÃ©nero</option>
                        ${genres.map(g => `<option value="${g}" ${g === file.genre ? 'selected' : ''}>${g}</option>`).join('')}
                    </select>
                    <select onchange="updateFileArtist('${file.id}', this.value)" id="artist_${file.id}">
                        <option value="">Seleccionar artista</option>
                        ${file.genre && artists[file.genre] && artists[file.genre].length > 0 ? artists[file.genre].map(a => 
                            `<option value="${a}" ${a === file.artist ? 'selected' : ''}>${a}</option>`
                        ).join('') : ''}
                    </select>
                    <button onclick="removeFile('${file.id}')" class="btn-danger">X</button>
                </div>
            `).join('');
        }

        function updateFileTitle(id, title) {
            const file = files.find(f => f.id == id);
            if (file) file.title = title;
        }

function updateFileGenre(id, genre) {
    const file = files.find(f => f.id == id);
    if (file) {
        file.genre = genre;
        file.artist = '';
        
        // Actualizar la lista de artistas del select especÃ­fico
        const artistSelect = document.querySelector(`#artist_${id}`);
        if (artistSelect) {
            artistSelect.innerHTML = '<option value="">Seleccionar artista</option>' +
                (genre && artists[genre] ? artists[genre].map(a => 
                    `<option value="${a}">${a}</option>`
                ).join('') : '');
        }
        
        updateStats();
    }
}

        function updateFileArtist(id, artist) {
            const file = files.find(f => f.id == id);
            if (file) file.artist = artist;
        }

        function removeFile(id) {
            files = files.filter(f => f.id != id);
            updateDisplay();
        }

        function clearAll() {
            files = [];
            updateDisplay();
            showMessage('Archivos eliminados', 'success');
        }

        function updateStats() {
            const stats = {};
            genres.forEach(genre => {
                stats[genre] = files.filter(f => f.genre === genre).length;
            });
            
            document.getElementById('stats').innerHTML = Object.keys(stats)
                .map(genre => `<div class="stat">${genre}: ${stats[genre]}</div>`)
                .join('');
        }

        function updateDisplay() {
            updateFileDisplay();
            updateStats();
        }

        function generateCode() {
            if (files.length === 0) {
                showMessage('No hay archivos para generar cÃ³digo', 'error');
                return;
            }

            const songs = files.map(f => ({
                title: f.title,
                artist: f.artist || 'Desconocido',
                file: `mp3/${f.genre}/${f.artist ? f.artist.toLowerCase().replace(/\s+/g, '_') + '/' : ''}${f.name}`,
                genre: f.genre,
                cover: `mp3/${f.genre}/${f.artist ? f.artist.toLowerCase().replace(/\s+/g, '_') + '/' : ''}cover.jpg`,
                duration: '0:00'
            }));

            const code = `async loadSongs() {
    this.songs = ${JSON.stringify(songs, null, 4)};
    
    this.filteredSongs = [...this.songs];
    this.renderPlaylist();
    
    if (this.songs.length > 0) {
        this.loadSong(0);
    }
}`;

            document.getElementById('codeOutput').textContent = code;
            document.getElementById('codeOutput').classList.remove('hidden');
            showMessage('CÃ³digo generado', 'success');
        }

        function showMessage(text, type) {
            const area = document.getElementById('messageArea');
            area.innerHTML = `<div class="message ${type}">${text}</div>`;
            setTimeout(() => area.innerHTML = '', 3000);
        }
    </script>
</body>
</html>
